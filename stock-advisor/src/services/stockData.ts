import { Stock, PricePoint } from '../types';

// Generate realistic price history
const generatePriceHistory = (
  currentPrice: number,
  volatility: number,
  trend: number,
  days: number = 365
): PricePoint[] => {
  const history: PricePoint[] = [];
  let price = currentPrice * (1 - trend * 0.3); // Start from a historical point

  const now = new Date();
  for (let i = days; i >= 0; i--) {
    const date = new Date(now);
    date.setDate(date.getDate() - i);

    // Random walk with trend
    const dailyReturn = (Math.random() - 0.5) * volatility + trend / 365;
    price = price * (1 + dailyReturn);

    const dailyVolatility = volatility * Math.random();
    const open = price * (1 + (Math.random() - 0.5) * dailyVolatility * 0.3);
    const close = price;
    const high = Math.max(open, close) * (1 + Math.random() * dailyVolatility * 0.5);
    const low = Math.min(open, close) * (1 - Math.random() * dailyVolatility * 0.5);

    history.push({
      date: date.toISOString().split('T')[0],
      open: Number(open.toFixed(2)),
      high: Number(high.toFixed(2)),
      low: Number(low.toFixed(2)),
      close: Number(close.toFixed(2)),
      volume: Math.floor(1000000 + Math.random() * 50000000),
    });
  }

  return history;
};

// Mock stock data
export const mockStocks: Stock[] = [
  {
    ticker: 'AAPL',
    name: 'Apple Inc.',
    logo: 'ðŸŽ',
    sector: 'Technology',
    description: 'Apple designs, manufactures, and markets smartphones, personal computers, tablets, wearables, and accessories worldwide. The company offers iPhone, Mac, iPad, and wearables, home, and accessories.',
    price: 178.52,
    previousClose: 175.84,
    change: 2.68,
    changePercent: 1.52,
    marketCap: 2780000000000,
    volume: 58234000,
    avgVolume: 52000000,
    high52Week: 199.62,
    low52Week: 143.90,
    pe: 28.5,
    eps: 6.26,
    dividend: 0.96,
    beta: 1.28,
    priceHistory: generatePriceHistory(178.52, 0.02, 0.15),
  },
  {
    ticker: 'MSFT',
    name: 'Microsoft Corporation',
    logo: 'ðŸªŸ',
    sector: 'Technology',
    description: 'Microsoft develops, licenses, and supports software, services, devices, and solutions worldwide. The company operates through Productivity and Business Processes, Intelligent Cloud, and More Personal Computing segments.',
    price: 378.91,
    previousClose: 374.58,
    change: 4.33,
    changePercent: 1.16,
    marketCap: 2810000000000,
    volume: 22145000,
    avgVolume: 20000000,
    high52Week: 420.82,
    low52Week: 275.37,
    pe: 35.2,
    eps: 10.76,
    dividend: 3.00,
    beta: 0.91,
    priceHistory: generatePriceHistory(378.91, 0.018, 0.22),
  },
  {
    ticker: 'GOOGL',
    name: 'Alphabet Inc.',
    logo: 'ðŸ”',
    sector: 'Technology',
    description: 'Alphabet provides online advertising services, search engine, cloud computing, software, and hardware. The company operates through Google Services, Google Cloud, and Other Bets segments.',
    price: 141.80,
    previousClose: 140.23,
    change: 1.57,
    changePercent: 1.12,
    marketCap: 1780000000000,
    volume: 24560000,
    avgVolume: 22000000,
    high52Week: 153.78,
    low52Week: 102.21,
    pe: 24.8,
    eps: 5.72,
    dividend: null,
    beta: 1.05,
    priceHistory: generatePriceHistory(141.80, 0.022, 0.18),
  },
  {
    ticker: 'AMZN',
    name: 'Amazon.com Inc.',
    logo: 'ðŸ“¦',
    sector: 'Consumer Cyclical',
    description: 'Amazon engages in retail sale of consumer products and subscriptions through online and physical stores. The company also manufactures and sells electronic devices and provides AWS cloud services.',
    price: 178.25,
    previousClose: 175.35,
    change: 2.90,
    changePercent: 1.65,
    marketCap: 1850000000000,
    volume: 45678000,
    avgVolume: 40000000,
    high52Week: 189.77,
    low52Week: 118.35,
    pe: 62.4,
    eps: 2.86,
    dividend: null,
    beta: 1.22,
    priceHistory: generatePriceHistory(178.25, 0.025, 0.25),
  },
  {
    ticker: 'NVDA',
    name: 'NVIDIA Corporation',
    logo: 'ðŸŽ®',
    sector: 'Technology',
    description: 'NVIDIA designs, develops, and markets graphics and compute solutions. The company provides GeForce GPUs for gaming, Quadro for visualization, Tesla for AI and high-performance computing.',
    price: 875.28,
    previousClose: 856.42,
    change: 18.86,
    changePercent: 2.20,
    marketCap: 2160000000000,
    volume: 42345000,
    avgVolume: 38000000,
    high52Week: 974.00,
    low52Week: 222.97,
    pe: 72.5,
    eps: 12.07,
    dividend: 0.16,
    beta: 1.68,
    priceHistory: generatePriceHistory(875.28, 0.035, 0.85),
  },
  {
    ticker: 'TSLA',
    name: 'Tesla Inc.',
    logo: 'âš¡',
    sector: 'Consumer Cyclical',
    description: 'Tesla designs, develops, manufactures, and sells electric vehicles and energy generation and storage systems. The company also offers vehicle service centers and Supercharger stations.',
    price: 248.50,
    previousClose: 255.70,
    change: -7.20,
    changePercent: -2.82,
    marketCap: 790000000000,
    volume: 98234000,
    avgVolume: 85000000,
    high52Week: 299.29,
    low52Week: 152.37,
    pe: 68.3,
    eps: 3.64,
    dividend: null,
    beta: 2.08,
    priceHistory: generatePriceHistory(248.50, 0.045, 0.12),
  },
  {
    ticker: 'META',
    name: 'Meta Platforms Inc.',
    logo: 'ðŸ‘¤',
    sector: 'Technology',
    description: 'Meta Platforms develops products that enable people to connect and share through mobile devices, personal computers, and virtual reality headsets. The company operates Facebook, Instagram, and WhatsApp.',
    price: 505.95,
    previousClose: 498.32,
    change: 7.63,
    changePercent: 1.53,
    marketCap: 1290000000000,
    volume: 15678000,
    avgVolume: 14000000,
    high52Week: 542.81,
    low52Week: 274.38,
    pe: 32.1,
    eps: 15.76,
    dividend: null,
    beta: 1.24,
    priceHistory: generatePriceHistory(505.95, 0.028, 0.45),
  },
  {
    ticker: 'JPM',
    name: 'JPMorgan Chase & Co.',
    logo: 'ðŸ¦',
    sector: 'Financial Services',
    description: 'JPMorgan Chase operates as a financial services company worldwide. The company provides investment banking, financial services for consumers and small businesses, commercial banking, and asset management.',
    price: 198.45,
    previousClose: 196.78,
    change: 1.67,
    changePercent: 0.85,
    marketCap: 571000000000,
    volume: 8456000,
    avgVolume: 7500000,
    high52Week: 215.96,
    low52Week: 135.19,
    pe: 11.2,
    eps: 17.72,
    dividend: 4.60,
    beta: 1.12,
    priceHistory: generatePriceHistory(198.45, 0.018, 0.20),
  },
  {
    ticker: 'JNJ',
    name: 'Johnson & Johnson',
    logo: 'ðŸ’Š',
    sector: 'Healthcare',
    description: 'Johnson & Johnson researches, develops, manufactures, and sells various products in the healthcare field worldwide. The company operates through Innovative Medicine and MedTech segments.',
    price: 156.32,
    previousClose: 157.45,
    change: -1.13,
    changePercent: -0.72,
    marketCap: 376000000000,
    volume: 6234000,
    avgVolume: 5800000,
    high52Week: 175.97,
    low52Week: 143.13,
    pe: 15.8,
    eps: 9.89,
    dividend: 4.76,
    beta: 0.52,
    priceHistory: generatePriceHistory(156.32, 0.012, 0.05),
  },
  {
    ticker: 'V',
    name: 'Visa Inc.',
    logo: 'ðŸ’³',
    sector: 'Financial Services',
    description: 'Visa operates as a payments technology company worldwide. The company operates VisaNet, a transaction processing network that enables authorization, clearing, and settlement of payment transactions.',
    price: 279.85,
    previousClose: 277.42,
    change: 2.43,
    changePercent: 0.88,
    marketCap: 559000000000,
    volume: 5678000,
    avgVolume: 5200000,
    high52Week: 290.96,
    low52Week: 227.32,
    pe: 30.5,
    eps: 9.17,
    dividend: 2.08,
    beta: 0.95,
    priceHistory: generatePriceHistory(279.85, 0.014, 0.12),
  },
  {
    ticker: 'WMT',
    name: 'Walmart Inc.',
    logo: 'ðŸ›’',
    sector: 'Consumer Defensive',
    description: 'Walmart engages in retail and wholesale business worldwide. The company operates through Walmart U.S., Walmart International, and Sam\'s Club segments, offering groceries and general merchandise.',
    price: 165.78,
    previousClose: 164.23,
    change: 1.55,
    changePercent: 0.94,
    marketCap: 446000000000,
    volume: 7890000,
    avgVolume: 7200000,
    high52Week: 169.94,
    low52Week: 141.56,
    pe: 27.8,
    eps: 5.96,
    dividend: 2.28,
    beta: 0.48,
    priceHistory: generatePriceHistory(165.78, 0.011, 0.10),
  },
  {
    ticker: 'DIS',
    name: 'The Walt Disney Company',
    logo: 'ðŸ°',
    sector: 'Communication Services',
    description: 'The Walt Disney Company operates as an entertainment company worldwide. The company operates through Disney Entertainment, ESPN, and Disney Experiences segments.',
    price: 112.45,
    previousClose: 114.82,
    change: -2.37,
    changePercent: -2.06,
    marketCap: 205000000000,
    volume: 12345000,
    avgVolume: 11000000,
    high52Week: 123.74,
    low52Week: 78.73,
    pe: 72.5,
    eps: 1.55,
    dividend: null,
    beta: 1.35,
    priceHistory: generatePriceHistory(112.45, 0.026, 0.08),
  },
  {
    ticker: 'NFLX',
    name: 'Netflix Inc.',
    logo: 'ðŸŽ¬',
    sector: 'Communication Services',
    description: 'Netflix provides entertainment services. The company offers TV series, documentaries, feature films, and games across various genres and languages through subscription streaming service.',
    price: 628.45,
    previousClose: 615.78,
    change: 12.67,
    changePercent: 2.06,
    marketCap: 272000000000,
    volume: 4567000,
    avgVolume: 4200000,
    high52Week: 700.99,
    low52Week: 344.73,
    pe: 45.2,
    eps: 13.90,
    dividend: null,
    beta: 1.42,
    priceHistory: generatePriceHistory(628.45, 0.032, 0.35),
  },
  {
    ticker: 'AMD',
    name: 'Advanced Micro Devices Inc.',
    logo: 'ðŸ’»',
    sector: 'Technology',
    description: 'AMD operates as a semiconductor company worldwide. The company provides data center and embedded processors, GPUs, and adaptive SoC products for data center, client, gaming, and embedded markets.',
    price: 168.92,
    previousClose: 172.45,
    change: -3.53,
    changePercent: -2.05,
    marketCap: 273000000000,
    volume: 52340000,
    avgVolume: 48000000,
    high52Week: 227.30,
    low52Week: 93.12,
    pe: 295.8,
    eps: 0.57,
    dividend: null,
    beta: 1.72,
    priceHistory: generatePriceHistory(168.92, 0.038, 0.28),
  },
  {
    ticker: 'KO',
    name: 'The Coca-Cola Company',
    logo: 'ðŸ¥¤',
    sector: 'Consumer Defensive',
    description: 'The Coca-Cola Company manufactures, markets, and sells various nonalcoholic beverages worldwide. The company provides sparkling soft drinks, water, sports, coffee, and tea brands.',
    price: 62.15,
    previousClose: 61.89,
    change: 0.26,
    changePercent: 0.42,
    marketCap: 268000000000,
    volume: 12340000,
    avgVolume: 11500000,
    high52Week: 67.20,
    low52Week: 54.02,
    pe: 24.3,
    eps: 2.56,
    dividend: 1.84,
    beta: 0.58,
    priceHistory: generatePriceHistory(62.15, 0.010, 0.06),
  },
  {
    ticker: 'COIN',
    name: 'Coinbase Global Inc.',
    logo: 'ðŸª™',
    sector: 'Financial Services',
    description: 'Coinbase Global operates as a financial infrastructure and technology company for the cryptoeconomy. The company provides a platform for buying, selling, transferring, and storing crypto assets.',
    price: 225.78,
    previousClose: 218.45,
    change: 7.33,
    changePercent: 3.36,
    marketCap: 54000000000,
    volume: 8765000,
    avgVolume: 7800000,
    high52Week: 283.48,
    low52Week: 70.12,
    pe: null,
    eps: -0.42,
    dividend: null,
    beta: 3.45,
    priceHistory: generatePriceHistory(225.78, 0.065, 0.55),
  },
  {
    ticker: 'GME',
    name: 'GameStop Corp.',
    logo: 'ðŸŽ®',
    sector: 'Consumer Cyclical',
    description: 'GameStop operates as a specialty retailer providing games and entertainment products through its stores and e-commerce platforms in the United States, Canada, Australia, and Europe.',
    price: 24.56,
    previousClose: 23.12,
    change: 1.44,
    changePercent: 6.23,
    marketCap: 7400000000,
    volume: 15678000,
    avgVolume: 12000000,
    high52Week: 64.83,
    low52Week: 10.01,
    pe: null,
    eps: -0.35,
    dividend: null,
    beta: 1.85,
    priceHistory: generatePriceHistory(24.56, 0.08, 0.15),
  },
  {
    ticker: 'SPY',
    name: 'SPDR S&P 500 ETF',
    logo: 'ðŸ“Š',
    sector: 'ETF',
    description: 'SPY tracks the S&P 500 index, providing exposure to 500 large-cap U.S. stocks. It is one of the most liquid and widely traded ETFs, ideal for broad market exposure.',
    price: 502.45,
    previousClose: 498.32,
    change: 4.13,
    changePercent: 0.83,
    marketCap: 475000000000,
    volume: 62340000,
    avgVolume: 58000000,
    high52Week: 524.61,
    low52Week: 409.21,
    pe: 22.8,
    eps: 22.04,
    dividend: 6.32,
    beta: 1.00,
    priceHistory: generatePriceHistory(502.45, 0.012, 0.14),
  },
  {
    ticker: 'QQQ',
    name: 'Invesco QQQ ETF',
    logo: 'ðŸ“ˆ',
    sector: 'ETF',
    description: 'QQQ tracks the Nasdaq-100 index, providing exposure to 100 of the largest non-financial companies listed on the Nasdaq, heavily weighted toward technology stocks.',
    price: 438.92,
    previousClose: 432.15,
    change: 6.77,
    changePercent: 1.57,
    marketCap: 215000000000,
    volume: 42150000,
    avgVolume: 38000000,
    high52Week: 467.28,
    low52Week: 324.93,
    pe: 32.5,
    eps: 13.50,
    dividend: 2.68,
    beta: 1.15,
    priceHistory: generatePriceHistory(438.92, 0.016, 0.18),
  },
  {
    ticker: 'VTI',
    name: 'Vanguard Total Stock Market ETF',
    logo: 'ðŸŒŽ',
    sector: 'ETF',
    description: 'VTI provides exposure to the entire U.S. stock market, including small-, mid-, and large-cap stocks. It offers comprehensive diversification at a very low cost.',
    price: 258.34,
    previousClose: 256.12,
    change: 2.22,
    changePercent: 0.87,
    marketCap: 385000000000,
    volume: 3456000,
    avgVolume: 3200000,
    high52Week: 270.64,
    low52Week: 211.76,
    pe: 21.5,
    eps: 12.02,
    dividend: 3.52,
    beta: 1.02,
    priceHistory: generatePriceHistory(258.34, 0.011, 0.12),
  },
];

// Stock data service
export const stockService = {
  getAllStocks: (): Stock[] => mockStocks,

  getStockByTicker: (ticker: string): Stock | undefined =>
    mockStocks.find(s => s.ticker.toUpperCase() === ticker.toUpperCase()),

  getTrendingStocks: (): Stock[] =>
    [...mockStocks]
      .sort((a, b) => Math.abs(b.changePercent) - Math.abs(a.changePercent))
      .slice(0, 6),

  getTopRatedStocks: (ratings: Map<string, number>): Stock[] =>
    [...mockStocks]
      .sort((a, b) => (ratings.get(b.ticker) || 0) - (ratings.get(a.ticker) || 0))
      .slice(0, 6),

  getHighRiskHighReward: (): Stock[] =>
    mockStocks
      .filter(s => s.beta > 1.5)
      .sort((a, b) => b.beta - a.beta)
      .slice(0, 6),

  getStocksByCategory: (category: 'tech' | 'finance' | 'healthcare' | 'consumer' | 'etf'): Stock[] => {
    const sectorMap: Record<string, string[]> = {
      tech: ['Technology'],
      finance: ['Financial Services'],
      healthcare: ['Healthcare'],
      consumer: ['Consumer Cyclical', 'Consumer Defensive', 'Communication Services'],
      etf: ['ETF'],
    };
    return mockStocks.filter(s => sectorMap[category]?.includes(s.sector));
  },

  searchStocks: (query: string): Stock[] => {
    const q = query.toLowerCase();
    return mockStocks.filter(
      s => s.ticker.toLowerCase().includes(q) ||
           s.name.toLowerCase().includes(q) ||
           s.sector.toLowerCase().includes(q)
    );
  },

  formatMarketCap: (cap: number): string => {
    if (cap >= 1e12) return `$${(cap / 1e12).toFixed(2)}T`;
    if (cap >= 1e9) return `$${(cap / 1e9).toFixed(2)}B`;
    if (cap >= 1e6) return `$${(cap / 1e6).toFixed(2)}M`;
    return `$${cap.toLocaleString()}`;
  },

  formatVolume: (vol: number): string => {
    if (vol >= 1e9) return `${(vol / 1e9).toFixed(2)}B`;
    if (vol >= 1e6) return `${(vol / 1e6).toFixed(2)}M`;
    if (vol >= 1e3) return `${(vol / 1e3).toFixed(2)}K`;
    return vol.toLocaleString();
  },
};
